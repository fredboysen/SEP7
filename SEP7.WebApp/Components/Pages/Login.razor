@page "/login"
@using SEP7.WebApp.Services
@using SEP7.WebAPI.Controllers
@using SEP7.WebAPI.Models
@inject HttpClient Http
@inject NavigationManager navMgr
@inject IAuthService authService
@inject NavigationManager Navigation
@rendermode InteractiveServer
@inherits LayoutComponentBase

<PageTitle>Login</PageTitle>

<div class="login-container">
    <img src="vola.png" alt="App Logo" class="login-logo" />
    
    <div>
        <h3>Login</h3>
        
        <!-- Username Field -->
        <div class="login-field">
            <label for="username" class="login-label">Username:</label>
            <input id="username" type="text" @bind="loginUsername" class="login-input" />
        </div>
        
        <!-- Password Field -->
        <div class="login-field">
            <label for="password" class="login-label">Password:</label>
            <input id="password" type="password" @bind="loginPassword" class="login-input" />
        </div>
        
        <!-- Error Message -->
        @if (!string.IsNullOrEmpty(loginErrorLabel))
        {
            <div class="login-field">
                <p class="login-error-message">@loginErrorLabel</p>
            </div>
        }
        
        <!-- Login Button -->
        <div class="login-field">
            <button class="login-button" @onclick="LoginAsync">Log in</button>
        </div>
    </div>
</div>

@code {
    private string loginUsername = "";
    private string loginPassword = "";
    private string loginErrorLabel = "";

    private async Task LoginAsync()
    {
        loginErrorLabel = "";
        try
        {
            await authService.LoginAsync(loginUsername, loginPassword);
            navMgr.NavigateTo("/");
        }
        catch (Exception e)
        {
            Console.WriteLine($"Login failed: {e.Message}");
            loginErrorLabel = $"Error: {e.Message}";
        }
    }
}
